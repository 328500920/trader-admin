# 交易计划模板 - 需求说明书与设计文档

## 一、需求背景

### 1.1 问题分析
- 很多交易者开单前没有明确计划，凭感觉操作
- 缺乏入场理由记录，事后无法复盘分析
- 止损止盈设置随意，导致亏损扩大或盈利过早了结
- 仓位管理混乱，风险控制不到位

### 1.2 目标用户
- 初级交易者：需要养成计划交易的习惯
- 中级交易者：需要优化交易策略，提升胜率
- 所有交易者：需要提升交易纪律性

### 1.3 核心价值
- **纪律性**：强制开单前思考，减少冲动交易
- **可追溯**：记录完整交易逻辑，便于复盘
- **数据化**：计划执行率、胜率等数据分析

---

## 二、功能需求

### 2.1 功能清单

| 功能模块 | 功能点 | 优先级 |
|---------|--------|--------|
| 计划创建 | 创建交易计划表单 | P0 |
| 计划创建 | 计划模板（快速填写） | P1 |
| 计划管理 | 计划列表（待执行/已执行/已取消） | P0 |
| 计划管理 | 计划详情查看 | P0 |
| 计划管理 | 编辑/取消计划 | P0 |
| 计划执行 | 标记计划已执行 | P0 |
| 计划执行 | 关联实际交易记录 | P1 |
| 数据分析 | 计划执行率统计 | P1 |
| 数据分析 | 计划 vs 实际对比 | P2 |

### 2.2 交易计划字段

#### 基础信息
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 交易对 | 选择/输入 | 是 | 如 BTC/USDT |
| 方向 | 单选 | 是 | 做多/做空 |
| 计划时间 | 日期时间 | 是 | 计划开仓时间 |

#### 价格设置
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 入场价格 | 数字 | 是 | 计划入场价 |
| 止损价格 | 数字 | 是 | 止损位 |
| 止盈价格1 | 数字 | 是 | 第一止盈目标 |
| 止盈价格2 | 数字 | 否 | 第二止盈目标 |
| 止盈价格3 | 数字 | 否 | 第三止盈目标 |

#### 仓位管理
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 仓位比例 | 百分比 | 是 | 占总资金比例 |
| 杠杆倍数 | 数字 | 是 | 1-125x |
| 风险金额 | 数字 | 否 | 本单最大亏损金额 |

#### 交易逻辑
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 入场理由 | 多选+文本 | 是 | 技术面/基本面/情绪面等 |
| 技术信号 | 多选 | 否 | K线形态/指标信号/支撑阻力等 |
| 市场环境 | 单选 | 否 | 趋势/震荡/不确定 |
| 信心指数 | 滑块 | 否 | 1-10分 |
| 备注 | 文本 | 否 | 其他补充说明 |

#### 状态信息
| 字段 | 类型 | 说明 |
|------|------|------|
| 状态 | 枚举 | 待执行/已执行/已取消/已过期 |
| 执行时间 | 日期时间 | 实际执行时间 |
| 关联交易ID | 外键 | 关联的实际交易记录 |

### 2.3 入场理由选项

```
技术面：
- K线形态信号
- 均线金叉/死叉
- MACD背离
- RSI超买超卖
- 支撑位反弹
- 阻力位突破
- 趋势线突破
- 布林带信号

基本面：
- 重大利好消息
- 项目进展更新
- 宏观经济事件
- 监管政策变化

情绪面：
- 恐惧贪婪指数
- 资金费率异常
- 多空比失衡
- 社交媒体热度

链上数据：
- 巨鲸异动
- 交易所流入流出
- 持仓分布变化
```

---

## 三、页面设计

### 3.1 页面结构

```
/trade/plan              # 交易计划列表页
/trade/plan/create       # 创建计划页
/trade/plan/:id          # 计划详情页
/trade/plan/:id/edit     # 编辑计划页
```

### 3.2 计划列表页

```
┌─────────────────────────────────────────────────────────┐
│  📋 交易计划                              [+ 新建计划]   │
├─────────────────────────────────────────────────────────┤
│  [待执行 3] [已执行 12] [已取消 2] [全部]               │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────┐   │
│  │ 🟢 BTC/USDT 做多                    待执行      │   │
│  │ 入场: $95,000  止损: $93,500  止盈: $98,000    │   │
│  │ 仓位: 10%  杠杆: 5x  风险: $150               │   │
│  │ 理由: 支撑位反弹 + MACD底背离                  │   │
│  │ 计划时间: 2024-12-30 14:00                    │   │
│  │                        [执行] [编辑] [取消]    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 🔴 ETH/USDT 做空                    已执行      │   │
│  │ ...                                             │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 3.3 创建计划页

```
┌─────────────────────────────────────────────────────────┐
│  📝 新建交易计划                                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 基础信息 ─────────────────────────────────────┐    │
│  │ 交易对: [BTC/USDT    ▼]  方向: ○做多 ●做空     │    │
│  │ 计划时间: [2024-12-30 14:00        ]           │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 价格设置 ─────────────────────────────────────┐    │
│  │ 入场价格: [$95,000    ]                        │    │
│  │ 止损价格: [$93,500    ]  止损幅度: -1.58%      │    │
│  │ ─────────────────────────────────────────      │    │
│  │ 止盈目标1: [$98,000   ]  盈亏比: 2.0           │    │
│  │ 止盈目标2: [$100,000  ]  盈亏比: 3.3           │    │
│  │ 止盈目标3: [          ]                        │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 仓位管理 ─────────────────────────────────────┐    │
│  │ 仓位比例: [====●=====] 10%                     │    │
│  │ 杠杆倍数: [5x     ▼]                           │    │
│  │ 风险金额: $150 (账户1%风险)                    │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 入场理由 ─────────────────────────────────────┐    │
│  │ [✓] 支撑位反弹  [✓] MACD底背离  [ ] 均线金叉   │    │
│  │ [ ] RSI超卖    [ ] 趋势线支撑  [ ] 其他        │    │
│  │                                                │    │
│  │ 详细说明:                                      │    │
│  │ ┌────────────────────────────────────────┐    │    │
│  │ │ 价格回踩前期支撑位93500，4H级别MACD    │    │    │
│  │ │ 出现底背离，预计反弹至98000...         │    │    │
│  │ └────────────────────────────────────────┘    │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 市场环境 ─────────────────────────────────────┐    │
│  │ 当前趋势: ○上涨 ●震荡 ○下跌                    │    │
│  │ 信心指数: [======●===] 7/10                    │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│                    [取消]  [保存计划]                   │
└─────────────────────────────────────────────────────────┘
```

---

## 四、数据库设计

### 4.1 交易计划表 (trade_plan)

```sql
CREATE TABLE trade_plan (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    
    -- 基础信息
    symbol VARCHAR(32) NOT NULL COMMENT '交易对',
    direction TINYINT NOT NULL COMMENT '方向: 1做多 2做空',
    plan_time DATETIME COMMENT '计划执行时间',
    
    -- 价格设置
    entry_price DECIMAL(20,8) NOT NULL COMMENT '入场价格',
    stop_loss_price DECIMAL(20,8) NOT NULL COMMENT '止损价格',
    take_profit_1 DECIMAL(20,8) COMMENT '止盈目标1',
    take_profit_2 DECIMAL(20,8) COMMENT '止盈目标2',
    take_profit_3 DECIMAL(20,8) COMMENT '止盈目标3',
    
    -- 仓位管理
    position_ratio DECIMAL(5,2) COMMENT '仓位比例%',
    leverage INT DEFAULT 1 COMMENT '杠杆倍数',
    risk_amount DECIMAL(20,8) COMMENT '风险金额',
    
    -- 交易逻辑
    entry_reasons VARCHAR(500) COMMENT '入场理由(JSON数组)',
    technical_signals VARCHAR(500) COMMENT '技术信号(JSON数组)',
    market_trend TINYINT COMMENT '市场趋势: 1上涨 2震荡 3下跌',
    confidence INT COMMENT '信心指数1-10',
    remark TEXT COMMENT '备注',
    
    -- 状态
    status TINYINT DEFAULT 1 COMMENT '状态: 1待执行 2已执行 3已取消 4已过期',
    execute_time DATETIME COMMENT '实际执行时间',
    trade_record_id BIGINT COMMENT '关联交易记录ID',
    
    -- 系统字段
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_plan_time (plan_time)
) COMMENT '交易计划表';
```

---

## 五、接口设计

### 5.1 接口列表

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/trade/plan | 创建计划 |
| GET | /api/trade/plan | 获取计划列表 |
| GET | /api/trade/plan/:id | 获取计划详情 |
| PUT | /api/trade/plan/:id | 更新计划 |
| PUT | /api/trade/plan/:id/execute | 执行计划 |
| PUT | /api/trade/plan/:id/cancel | 取消计划 |
| GET | /api/trade/plan/stats | 计划统计数据 |

### 5.2 创建计划接口

**请求**
```json
POST /api/trade/plan
{
    "symbol": "BTC/USDT",
    "direction": 1,
    "planTime": "2024-12-30T14:00:00",
    "entryPrice": 95000,
    "stopLossPrice": 93500,
    "takeProfit1": 98000,
    "takeProfit2": 100000,
    "positionRatio": 10,
    "leverage": 5,
    "riskAmount": 150,
    "entryReasons": ["支撑位反弹", "MACD底背离"],
    "technicalSignals": ["support_bounce", "macd_divergence"],
    "marketTrend": 2,
    "confidence": 7,
    "remark": "价格回踩前期支撑位..."
}
```

**响应**
```json
{
    "code": 200,
    "data": {
        "id": 1,
        "symbol": "BTC/USDT",
        ...
    }
}
```

---

## 六、交互流程

### 6.1 创建计划流程

```
用户点击"新建计划"
    ↓
填写交易对、方向
    ↓
设置入场价、止损价、止盈价
    ↓
系统自动计算止损幅度、盈亏比
    ↓
设置仓位比例、杠杆
    ↓
系统自动计算风险金额
    ↓
选择入场理由（多选）
    ↓
填写详细说明（可选）
    ↓
保存计划
    ↓
计划进入"待执行"列表
```

### 6.2 执行计划流程

```
用户在"待执行"列表点击"执行"
    ↓
弹窗确认：是否按计划执行？
    ↓
[是] → 计划状态变为"已执行"
    ↓
可选：关联实际交易记录
    ↓
后续可对比计划与实际
```

---

## 七、后续迭代

### 7.1 V2 功能
- 计划模板：保存常用计划为模板
- 计划提醒：到达计划时间推送通知
- 批量操作：批量取消过期计划

### 7.2 V3 功能
- 计划执行率分析
- 计划 vs 实际盈亏对比
- AI 建议：根据历史数据优化计划参数
