# 交易心理日记 - 需求说明书与设计文档

## 一、需求背景

### 1.1 问题分析
- 情绪是交易最大的敌人，但很少有人系统记录和分析
- FOMO（错失恐惧）、报复性交易等心理陷阱频繁发生
- 交易者不了解自己的情绪模式和触发因素
- 缺乏情绪与交易结果的关联分析

### 1.2 目标用户
- 所有交易者：需要认识和管理自己的交易情绪
- 频繁亏损者：可能存在情绪化交易问题
- 追求稳定盈利者：需要保持情绪稳定

### 1.3 核心价值
- **自我认知**：了解自己的情绪模式
- **预警机制**：识别危险情绪状态，避免冲动交易
- **数据分析**：情绪与盈亏的关联，找出最佳交易状态

---

## 二、功能需求

### 2.1 功能清单

| 功能模块 | 功能点 | 优先级 |
|---------|--------|--------|
| 日记记录 | 每日情绪打卡 | P0 |
| 日记记录 | 交易时情绪记录 | P0 |
| 日记记录 | 心理陷阱标记 | P0 |
| 日记管理 | 日记列表（日历视图） | P0 |
| 日记管理 | 日记详情查看/编辑 | P0 |
| 数据分析 | 情绪趋势图 | P1 |
| 数据分析 | 情绪与盈亏关联 | P1 |
| 数据分析 | 心理陷阱统计 | P1 |
| 辅助功能 | 情绪预警提示 | P2 |
| 辅助功能 | 冷静期建议 | P2 |

### 2.2 每日情绪打卡字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 日期 | 日期 | 是 | 打卡日期 |
| 整体情绪 | 滑块 | 是 | 1-10分 |
| 情绪标签 | 多选 | 否 | 平静/焦虑/兴奋/恐惧/贪婪等 |
| 睡眠质量 | 单选 | 否 | 很差/较差/一般/良好/很好 |
| 身体状态 | 单选 | 否 | 疲惫/一般/精力充沛 |
| 外部压力 | 滑块 | 否 | 1-10分 |
| 今日计划 | 文本 | 否 | 今天的交易计划 |
| 今日反思 | 文本 | 否 | 今天的交易反思 |

### 2.3 交易时情绪记录字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 关联交易 | 选择 | 否 | 关联的交易记录 |
| 开仓情绪 | 滑块 | 是 | 1-10分 |
| 持仓情绪 | 滑块 | 否 | 1-10分 |
| 平仓情绪 | 滑块 | 否 | 1-10分 |
| 心理陷阱 | 多选 | 否 | 是否触发心理陷阱 |
| 情绪描述 | 文本 | 否 | 详细描述当时心理状态 |

### 2.4 心理陷阱类型

```
常见心理陷阱：

📍 FOMO（错失恐惧）
   - 看到别人赚钱急于入场
   - 害怕错过行情追高/追低

📍 报复性交易
   - 亏损后急于回本
   - 加大仓位想一把翻盘

📍 过度自信
   - 连续盈利后放松警惕
   - 忽视风险管理

📍 损失厌恶
   - 不愿止损，死扛亏损单
   - 过早止盈，害怕利润回吐

📍 确认偏误
   - 只看支持自己观点的信息
   - 忽视反向信号

📍 锚定效应
   - 执着于某个价格点位
   - 不愿接受市场变化

📍 赌徒谬误
   - 认为连续亏损后必然盈利
   - 加倍下注想回本

📍 从众心理
   - 盲目跟随大众观点
   - 不独立思考

📍 沉没成本
   - 因为已经亏损而不愿离场
   - 继续持有亏损头寸
```

---

## 三、页面设计

### 3.1 页面结构

```
/psychology              # 心理日记首页（日历视图）
/psychology/daily        # 每日打卡页
/psychology/trade/:id    # 交易情绪记录页
/psychology/analysis     # 情绪分析页
```

### 3.2 心理日记首页（日历视图）

```
┌─────────────────────────────────────────────────────────┐
│  🧠 交易心理日记                        [+ 今日打卡]    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 本月情绪概览 ─────────────────────────────────┐    │
│  │ 平均情绪: 6.8/10  📈 较上月+0.5                │    │
│  │ 打卡天数: 22/30   心理陷阱: 5次               │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 2024年12月 ───────────────────────────────────┐    │
│  │  一   二   三   四   五   六   日              │    │
│  │                                                │    │
│  │                              1    2    3       │    │
│  │                             😐   😊   😊      │    │
│  │                                                │    │
│  │  4    5    6    7    8    9    10             │    │
│  │ 😊   😰   😤   😐   😊   😊   😴             │    │
│  │      ⚠️   ⚠️                                  │    │
│  │                                                │    │
│  │  11   12   13   14   15   16   17             │    │
│  │ 😊   😊   😐   😊   😰   😊   😊             │    │
│  │                      ⚠️                        │    │
│  │  ...                                          │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  图例: 😊 良好(7-10) 😐 一般(4-6) 😰 较差(1-3)        │
│       ⚠️ 触发心理陷阱                                  │
│                                                         │
│  ┌─ 最近记录 ─────────────────────────────────────┐    │
│  │ 12月29日 情绪: 8/10 😊                         │    │
│  │ 今天状态很好，严格执行了交易计划...            │    │
│  │                                                │    │
│  │ 12月28日 情绪: 5/10 😐  ⚠️ FOMO               │    │
│  │ 看到BTC拉升忍不住追高，结果被套...            │    │
│  └────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### 3.3 每日打卡页

```
┌─────────────────────────────────────────────────────────┐
│  📝 每日情绪打卡                     2024年12月30日     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 整体情绪 ─────────────────────────────────────┐    │
│  │                                                │    │
│  │  😰 ─────────────●───────────── 😊            │    │
│  │  1  2  3  4  5  6  7  8  9  10                │    │
│  │                                                │    │
│  │  当前: 7/10 - 状态良好                         │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 情绪标签 ─────────────────────────────────────┐    │
│  │ [✓] 平静   [ ] 焦虑   [ ] 兴奋                │    │
│  │ [ ] 恐惧   [ ] 贪婪   [✓] 自信                │    │
│  │ [ ] 沮丧   [ ] 愤怒   [ ] 迷茫                │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 身心状态 ─────────────────────────────────────┐    │
│  │ 睡眠质量: ○很差 ○较差 ○一般 ●良好 ○很好      │    │
│  │ 身体状态: ○疲惫 ○一般 ●精力充沛              │    │
│  │ 外部压力: [===●======] 3/10                   │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 心理陷阱检查 ─────────────────────────────────┐    │
│  │ 今天是否触发以下心理陷阱？                     │    │
│  │                                                │    │
│  │ [ ] FOMO（错失恐惧）                          │    │
│  │ [ ] 报复性交易                                │    │
│  │ [ ] 过度自信                                  │    │
│  │ [ ] 损失厌恶                                  │    │
│  │ [ ] 其他: [                    ]              │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 今日反思 ─────────────────────────────────────┐    │
│  │ ┌────────────────────────────────────────┐    │    │
│  │ │ 今天整体状态不错，早盘的BTC多单严格     │    │    │
│  │ │ 按计划执行，止盈后没有追高。下午有点    │    │    │
│  │ │ 想做空ETH但没有明确信号，忍住了...      │    │    │
│  │ └────────────────────────────────────────┘    │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│                    [取消]  [保存打卡]                   │
└─────────────────────────────────────────────────────────┘
```

### 3.4 情绪分析页

```
┌─────────────────────────────────────────────────────────┐
│  📊 情绪分析                    [本周] [本月] [全部]    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 情绪趋势 ─────────────────────────────────────┐    │
│  │     10 ┤                                       │    │
│  │      8 ┤    ╭─╮     ╭───╮                     │    │
│  │      6 ┤ ╭──╯ ╰─╮ ╭─╯   ╰──╮                 │    │
│  │      4 ┤─╯      ╰─╯        ╰──               │    │
│  │      2 ┤                                       │    │
│  │        └────────────────────────────────────   │    │
│  │         1  5  10  15  20  25  30 (日期)       │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 情绪与盈亏关联 ───────────────────────────────┐    │
│  │                                                │    │
│  │  情绪 7-10分时:  胜率 68%  平均盈利 +2.3%     │    │
│  │  情绪 4-6分时:   胜率 45%  平均盈利 -0.5%     │    │
│  │  情绪 1-3分时:   胜率 28%  平均盈利 -3.1%     │    │
│  │                                                │    │
│  │  💡 建议: 情绪低于5分时避免交易               │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 心理陷阱统计 ─────────────────────────────────┐    │
│  │                                                │    │
│  │  FOMO         ████████░░  8次  (最常见)       │    │
│  │  报复性交易   █████░░░░░  5次                 │    │
│  │  过度自信     ███░░░░░░░  3次                 │    │
│  │  损失厌恶     ██░░░░░░░░  2次                 │    │
│  │                                                │    │
│  │  ⚠️ FOMO后平均亏损: -2.8%                     │    │
│  │  ⚠️ 报复性交易后平均亏损: -4.2%               │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─ 最佳交易状态 ─────────────────────────────────┐    │
│  │                                                │    │
│  │  🏆 你的最佳交易状态:                          │    │
│  │  • 情绪评分: 7-8分                            │    │
│  │  • 睡眠质量: 良好以上                         │    │
│  │  • 情绪标签: 平静、自信                       │    │
│  │  • 外部压力: 低于4分                          │    │
│  │                                                │    │
│  │  在此状态下胜率: 72%                          │    │
│  └────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

---

## 四、数据库设计

### 4.1 每日情绪记录表 (psychology_daily)

```sql
CREATE TABLE psychology_daily (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    record_date DATE NOT NULL COMMENT '记录日期',
    
    -- 情绪评分
    mood_score INT NOT NULL COMMENT '整体情绪1-10',
    mood_tags VARCHAR(200) COMMENT '情绪标签(JSON数组)',
    
    -- 身心状态
    sleep_quality TINYINT COMMENT '睡眠质量: 1很差-5很好',
    physical_state TINYINT COMMENT '身体状态: 1疲惫 2一般 3精力充沛',
    external_pressure INT COMMENT '外部压力1-10',
    
    -- 心理陷阱
    traps VARCHAR(200) COMMENT '触发的心理陷阱(JSON数组)',
    
    -- 文字记录
    daily_plan TEXT COMMENT '今日计划',
    daily_reflection TEXT COMMENT '今日反思',
    
    -- 系统字段
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_date (user_id, record_date),
    INDEX idx_user_id (user_id),
    INDEX idx_record_date (record_date)
) COMMENT '每日情绪记录表';
```

### 4.2 交易情绪记录表 (psychology_trade)

```sql
CREATE TABLE psychology_trade (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    trade_record_id BIGINT COMMENT '关联交易记录ID',
    
    -- 情绪评分
    entry_mood INT COMMENT '开仓情绪1-10',
    holding_mood INT COMMENT '持仓情绪1-10',
    exit_mood INT COMMENT '平仓情绪1-10',
    
    -- 心理陷阱
    traps VARCHAR(200) COMMENT '触发的心理陷阱(JSON数组)',
    
    -- 描述
    description TEXT COMMENT '情绪描述',
    
    -- 系统字段
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_trade_record_id (trade_record_id)
) COMMENT '交易情绪记录表';
```

---

## 五、接口设计

### 5.1 接口列表

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/psychology/daily | 创建/更新每日打卡 |
| GET | /api/psychology/daily | 获取每日记录列表 |
| GET | /api/psychology/daily/:date | 获取指定日期记录 |
| POST | /api/psychology/trade | 创建交易情绪记录 |
| GET | /api/psychology/trade | 获取交易情绪列表 |
| GET | /api/psychology/analysis | 获取情绪分析数据 |
| GET | /api/psychology/calendar | 获取日历数据 |

### 5.2 每日打卡接口

**请求**
```json
POST /api/psychology/daily
{
    "recordDate": "2024-12-30",
    "moodScore": 7,
    "moodTags": ["平静", "自信"],
    "sleepQuality": 4,
    "physicalState": 3,
    "externalPressure": 3,
    "traps": [],
    "dailyPlan": "今天计划观望，等待明确信号",
    "dailyReflection": "今天整体状态不错..."
}
```

### 5.3 情绪分析接口

**响应**
```json
GET /api/psychology/analysis?period=month
{
    "code": 200,
    "data": {
        "moodTrend": [
            {"date": "2024-12-01", "score": 6},
            {"date": "2024-12-02", "score": 7},
            ...
        ],
        "moodProfitCorrelation": {
            "high": {"winRate": 0.68, "avgProfit": 2.3},
            "medium": {"winRate": 0.45, "avgProfit": -0.5},
            "low": {"winRate": 0.28, "avgProfit": -3.1}
        },
        "trapStats": [
            {"trap": "FOMO", "count": 8, "avgLoss": -2.8},
            {"trap": "报复性交易", "count": 5, "avgLoss": -4.2}
        ],
        "bestState": {
            "moodRange": [7, 8],
            "sleepQuality": "良好以上",
            "moodTags": ["平静", "自信"],
            "winRate": 0.72
        }
    }
}
```

---

## 六、交互流程

### 6.1 每日打卡流程

```
用户进入心理日记页面
    ↓
检查今日是否已打卡
    ↓
[未打卡] → 显示打卡入口提示
    ↓
点击"今日打卡"
    ↓
滑动选择情绪分数
    ↓
选择情绪标签（可选）
    ↓
填写身心状态（可选）
    ↓
检查心理陷阱（可选）
    ↓
填写今日反思（可选）
    ↓
保存打卡
    ↓
日历更新显示今日情绪
```

### 6.2 情绪预警流程

```
用户打卡情绪 ≤ 4分
    ↓
系统弹出预警提示
    ↓
"当前情绪状态较差，建议今日减少交易或观望"
    ↓
显示历史数据：低情绪时的交易胜率
    ↓
用户确认了解
```

---

## 七、后续迭代

### 7.1 V2 功能
- 情绪预警推送
- 冷静期倒计时（触发心理陷阱后建议休息）
- 情绪日记导出

### 7.2 V3 功能
- AI 情绪分析建议
- 情绪模式识别
- 个性化交易建议
